"use strict";var Typonerdory=angular.module("Typonerdory",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/play",{templateUrl:"views/play.html",controller:"PlayController"}).otherwise({redirectTo:"/"})}]);Typonerdory.run(["$rootScope","titleService",function(a,b){a.$on("$routeChangeStart",function(c,d,e){var f,g="Typonerdory Â» ";switch(d.$route.controller){case"HomeController":f="home",g+="Hello";break;case"PlayController":f="play",g+="The Game"}b.set(g),a.section=f})}]),Typonerdory.service("dataService",["$q","$http",function(a,b){"use strict";var c="http://typonerdory-apiwrapper.aws.af.cm/?callback=JSON_CALLBACK",d;this.initialize=function(){var e=a.defer();return d===undefined?b({method:"JSONP",url:c}).success(function(a){d=a,e.resolve(d)}).error(function(a,b,c,d){console.log(d)}):e.resolve(d),e.promise}}]),Typonerdory.service("gameService",["$timeout","nameService",function(a,b){"use strict";var c={players:[],decks:[],time:1,finished:!1,winner:null},d={};d.tick=function(){a(function(){c.time=c.time+1,d.tick()},1e3)},d.cloneDeck=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},d.getActivePlayer=function(){return _.where(c.players,{active:!0})[0]},d.setActivePlayer=function(a){c.players[a].active=!0},d.nextPlayer=function(){var a,b=c.players.length,e=0,f;for(e;e<b;e+=1)a=c.players[e],a.active&&(f=e),a.active=!1;c.players[f+1]?d.setActivePlayer(f+1):d.setActivePlayer(0)},d.getWinner=function(){var a=c.players[0],b=c.players[1];return a.points>b.points?a:b},d.getDeck=function(a){return _.where(c.decks,{id:a})[0]},d.getDecks=function(){return c.decks},d.getFoundDecks=function(){var a=_.filter(c.decks,function(a){return a.found!==!1})||{length:0};return a||(a=0),a},d.getSelectedDecks=function(){return _.where(c.decks,{selected:!0})},d.clearSelectedDecks=function(){var a,b=c.decks.length,d=0;for(d;d<b;d+=1)a=c.decks[d],a.selected=!1},this.start=function(a){var e,f,g=a.length,h=0;c.players.push({id:0,name:b.generate(),points:0,active:!1}),c.players.push({id:1,name:b.generate(c.players[0].name),points:0,active:!1});for(h;h<g;h+=1)f=a[h],e=d.cloneDeck(f),c.decks.push({id:f.id,content:{family:f.family,variant:f.variant},found:!1,selected:!1}),c.decks.push({id:e.id+"-cloned",content:{family:e.family,variant:e.variant},found:!1,selected:!1});c.decks=_.shuffle(c.decks),g=c.decks.length,h=0;for(h;h<g;h+=1)f=c.decks[h],f.no=h+1;return d.setActivePlayer([Math.floor(Math.random()*c.players.length)]),d.tick(),c},this.selectDeck=function(b){var e=d.getDeck(b),f=d.getActivePlayer(),g,h,i;e.selected=!0,i=d.getSelectedDecks(),2===i.length&&a(function(){g=i[0],h=i[1],g.content.family===h.content.family?(f.points=f.points+1,g.found=h.found=f.id):d.nextPlayer(),d.clearSelectedDecks(),d.getDecks().length===d.getFoundDecks().length&&(c.winner=d.getWinner(),c.finished=!0)},1e3)}}]),Typonerdory.service("nameService",[function(){"use strict";var a=["Valentina","Kimberley","Violetta","Leoni","Kim","Michael","Mia","Matthew","William","Ella","Grace"];this.generate=function(b){var c=a[Math.floor(Math.random()*a.length)];return c===b?this.generate(b):c}}]),Typonerdory.service("titleService",["$window",function(a){"use strict",this.set=function(b){a.document.title=b},this.get=function(){return a.document.title}}]),Typonerdory.directive("fader",[function(){return"use strict",{restrict:"A",link:function(a,b,c){$(b[0]).css({opacity:0}).animate({opacity:1},parseInt(c.fader,10),"ease-out")}}}]),Typonerdory.controller("HomeController",[function(a){"use strict"}]),Typonerdory.controller("PlayController",["$rootScope","$scope","dataService","gameService",function(a,b,c,d){"use strict",c.initialize().then(function(c){a.fonts=c,b.game=d.start(a.fonts)}),b.selectDeck=function(a){d.selectDeck(a)}}]);